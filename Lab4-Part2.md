## Практическое задание №4 по дисциплине "Основы построения баз данных", ВШЭКН ЮУрГУ, 2019/2020 учебный год

В ходе выполнения практического задания №4 вы познакомитесь с СУБД MySQL 8.0, научитесь создавать и заполнять базы данных с использованием операторов языка SQL, а также формировать запросы на выборку с использованием оператора SELECT.

## Часть 2

В ходе выполнения второй части практического задания 4 необходимо опираться на практическое задание 2, в котором вы создавали базу данных Деканат, включающую в себя несколько таблиц. 

### Задание 1. Создание базы данных "Деканат" с использованием языка SQL

+ Перед началом работы создайте файл, в который будут записываться все ваши команды. которые вы будете вводить в течение выполнения данного практического задания. Этот файл необходимо будет отправить для проверки выполнения второй части практического задания 4. Имя файла должно быть в формате "L4-P2-XXXФамилия.log", где XXX - номер вашей группы, после которого следует ваша фамилия латинскими буквами. Программа автоматически создаст файл с указанным именем. Для того чтобы начать запись в файл, необходимо ввести следующую команду (укажите тот путь, по которому вы хотите сохранить этот файл).  

		mysql> \T C:/Users/Oleg/Documents/GitHub/MySQL_examples/L1-P1-XXXBushuev.log

  Для того чтобы остановить запись в файл, используйте команду
  
  		mysql> \t
  
+ Создайте новую базу данных DekanatXX, где XX – номер варианта студента. Для создания базы данных используйте выражение CREATE SCHEMA или CREATE DATABASE. Переключитесь на нее с помощью команды USE.

+ Создайте новую таблицу Students, которая будет содержать данные студентов. Определите следующие названия полей и их типы данных:

		+-------------+-------------+------+-----+---------+-------+
		| Field       | Type        | Null | Key | Default | Extra |
		+-------------+-------------+------+-----+---------+-------+
		| StudentID   | int(11)     | NO   | PRI | NULL    |       |
		| LastName    | varchar(15) | NO   |     | NULL    |       |
		| FirstName   | varchar(15) | NO   |     | NULL    |       |
		| MiddleName  | varchar(15) | YES  |     | NULL    |       |
		| GroupNumber | int(11)     | NO   |     | NULL    |       |
		| PhoneNumber | char(10)    | YES  |     | NULL    |       |
		| Stipend     | varchar(3)  | YES  |     | Нет     |       |
		+-------------+-------------+------+-----+---------+-------+
  
  Обратите внимание на поля, значение которых не может быть NULL, а также на ключевое поле. В поле Stipend (стипендия) необходимо добавить значение по умолчанию 'Нет'.
  
+ Создайте новую таблицу Courses, которая будет содержать дисциплины.  Определите следующие названия полей и их типы данных:

		+------------+--------------+------+-----+---------+-------+
		| Field      | Type         | Null | Key | Default | Extra |
		+------------+--------------+------+-----+---------+-------+
		| CourseID   | int(11)      | NO   | PRI | NULL    |       |
		| CourseName | varchar(255) | NO   |     | NULL    |       |
		+------------+--------------+------+-----+---------+-------+

+ Создайте новую таблицу Lecturers, которая будет содержать данные преподавателей. Определите следующие названия полей и их типы данных:

		+-------------+-------------+------+-----+---------+----------------+
		| Field       | Type        | Null | Key | Default | Extra          |
		+-------------+-------------+------+-----+---------+----------------+
		| LecturerID  | int(11)     | NO   | PRI | NULL    | auto_increment |
		| LastName    | varchar(15) | NO   |     | NULL    |                |
		| FirstName   | varchar(15) | NO   |     | NULL    |                |
		| MiddleName  | varchar(15) | YES  |     | NULL    |                |
		| BirthDate   | date        | YES  |     | NULL    |                |
		| Position    | varchar(9)  | NO   |     | NULL    |                |
		| PhoneNumber | char(10)    | YES  |     | NULL    |                |
		| CourseID    | int(11)     | NO   |     | NULL    |                |
		+-------------+-------------+------+-----+---------+----------------+


  Вместо того, чтобы написать новую команду для создания таблицы Lecturers, вы можете использовать команду для создания таблицы Lecturers из первой части четвертого практического задания. В этом случае ваша таблица будет иметь поле Course (Дисциплина), который можно удалить, а вместо него добавить новое поле CourseID (КодДисциплины), используя оператор ALTER:
  
  		mysql> ALTER TABLE Lecturers DROP COLUMN Course; 		-- удалить столбец (поле) Course из таблицы Lecturers
		mysql> ALTER TABLE Lecturers ADD CourseID INTEGER NOT NULL;	-- столбец (поле) CourseID в таблицу Lecturers

+ Создайте новую таблицу Marks, которая будет содержать оценки. Определите следующие названия полей и их типы данных:

		+-----------+---------+------+-----+---------+-------+
		| Field     | Type    | Null | Key | Default | Extra |
		+-----------+---------+------+-----+---------+-------+
		| StudentID | int(11) | NO   | PRI | NULL    |       |
		| CourseID  | int(11) | NO   | PRI | NULL    |       |
		| Mark      | int(1)  | YES  |     | NULL    |       |
		+-----------+---------+------+-----+---------+-------+
  
  Обратите внимание, в этой таблице первичным ключом будет не одно, а два поля, поскольку значения в каждом отдельном поле могут повторяться, то для каждого студента по одной дисциплине может быть только одна оценка. Добиться этого можно, указав при создании таблицы выражение PRIMARY KEY(StudentID, CourseID).
  
+ Проверьте структуру созданных таблиц с помощью выражения DESCRIBE.

+ Установите связи между таблицами, задайте каскадное обновление и каскадное удаление связанных записей. В MS Access вы использовали графический интерфейс для редактирования схемы данных. В MySQL для этой цели служит оператор ALTER, который позволяет установить связи между таблицами путем создания правил целостности FOREIGN KEY (внешний ключ). Внешний ключ устанавливается для столбцов из зависимой, подчиненной таблицы, и указывает на один из столбцов из главной таблицы. Как правило, внешний ключ указывает на первичный ключ из связанной главной таблицы. Общий синтаксис установки внешнего ключа на уровне таблицы:

		[CONSTRAINT имя_ограничения]
		FOREIGN KEY (столбец1, столбец2, ... столбецN) 
		REFERENCES главная_таблица (столбец_главной_таблицы1, столбец_главной_таблицы2, ... столбец_главной_таблицыN)
		[ON DELETE действие]
		[ON UPDATE действие]
		
  Для создания ограничения внешнего ключа после FOREIGN KEY указывается столбец таблицы, который будет представляет внешний ключ. А после ключевого слова REFERENCES указывается имя связанной таблицы, а затем в скобках имя связанного столбца, на который будет указывать внешний ключ. После выражения REFERENCES идут необязательные выражения ON DELETE и ON UPDATE, которые задают действие при удалении и обновлении строки из главной таблицы соответственно. При установлении каскадного обновления и каскадного удаления используется выражение CASCADE. Внешние ключи можно указывать и при создании таблиц. Подробнее прочесть про FOREIGN KEY можно в официальной документации по ссылке: https://dev.mysql.com/doc/refman/8.0/en/create-table-foreign-keys.html#foreign-key-referential-actions.
  В нашей базе данных необходимо установить следующие связи: 
  
  		-- между таблицами Marks и Courses через поле CourseId
  
  		mysql> ALTER TABLE Marks 
  			ADD CONSTRAINT FK_Mark_Course 
 			FOREIGN KEY(CourseId) REFERENCES Courses(CourseId)
  			ON DELETE CASCADE
  			ON UPDATE CASCADE;
		Query OK, 0 rows affected (0.05 sec)
		Records: 0  Duplicates: 0  Warnings: 0

  		-- между таблицами Marks и Students через поле StudentId 

		mysql> ALTER TABLE Marks 
			ADD CONSTRAINT FK_Mark_Student 
			FOREIGN KEY(StudentId) REFERENCES Students(StudentId)
			ON DELETE CASCADE
			ON UPDATE CASCADE;
		Query OK, 0 rows affected (0.07 sec)
		Records: 0  Duplicates: 0  Warnings: 0
		
		-- между таблицами Lecturers и Courses через поле CourseId 

		mysql> ALTER TABLE Lecturers
		  	ADD CONSTRAINT FK_Lecturer_Course 
			FOREIGN KEY(CourseId) REFERENCES Courses(CourseId)
			ON DELETE CASCADE
			ON UPDATE CASCADE;
		Query OK, 0 rows affected (0.06 sec)
		Records: 0  Duplicates: 0  Warnings: 0
  
+ Проверьте созданные внешние ключи, используя команду SHOW CREATE TABLE table_name
  
  		mysql> SHOW CREATE TABLE marks;
		
+ Заполните таблицы аналогично тому, как было указано во второй практической работе, используя оператор INSERT. Обратите внимание, что в таблице Lecturers (Преподаватели) должно быть 8 записей (строк), в таблице Students (Студенты) должно быть 20 записей (строк), в таблице Courses (Дисциплины) - 4 записи, в талице Marks (Оценки) должны быть оценки для каждого студента по каждой дисциплине - всего 80 записей.

### Задание 2. Составление запросов



+ Завершите запись команд в файл и отправьте ваш файл "L4-P2-XXXФамилия.log" на проверку (в элементе курса "Сдать на проверку Практическое задание 4").

